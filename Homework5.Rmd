---
title: "Homework 5, Amelia Grant-Alfieri, ag3911"
output: github_document
---

# Problem 1

## Tidy Data
Tidy dataframe should include data from all participants, including the subject ID, arm, and observations over time:
```{r message=FALSE}
library(tidyverse)
library(dplyr)
library(tidyr)
library(purrr)
library(readr)
getwd()

csv_files = dir(path = "/Users/ameliaga/Documents/MPH Sem 3/Data Science/p8105_hw5_ag3911/homework5/", pattern = "*.csv")
csv_files

vec_csv = str_c(csv_files)

tidy = vec_csv %>%
  map(read_csv) %>%    
  reduce(rbind) %>%
  mutate(arm = 1:20) %>%
  mutate(ID = 1:20) %>%
  mutate(arm = as.character(arm)) %>%
  mutate(arm = if_else(arm == 1:10, "con", "exp")) %>%
  gather(key = week, value = "observation", week_1:week_8) %>%
  separate(week, into = c("delete", "week"), sep = "_") %>%  
  select(-delete) 
```

## Plot observations of each subject over time 
Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.
```{r}
library(ggplot2)
tidy %>%
  ggplot(aes(x = week, y = observation, group = ID, color = ID)) + geom_line() + labs(title = "Subject Observations over Eight Weeks", color = "Subject ID") + scale_color_gradientn(colours = rainbow(5))
```


# Problem 2
The Washington Post has gathered data on homicides in 50 large U.S. cities and made the data available through a GitHub repository here. You can read their accompanying article here.

## Tidy Data
* Describe the raw data. 
* Create a city_state variable (e.g. “Baltimore, MD”). 
* Summarize within cities to obtain the total number of homicides and the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”).

## Estimate proportion of unsolved homicides in Baltimore, MD
* For the city of Baltimore, MD, use the prop.test function to estimate the proportion of homicides that are unsolved; 
* save the output of prop.test as an R object, apply the broom::tidy to this object and pull the estimated proportion and confidence intervals from the resulting tidy dataframe.

## Estimate proportion of unsolved homicides in each city 
* run prop.test for each of the cities in your dataset
* extract both the proportion of unsolved homicides and the confidence interval for each
* Do this within a “tidy” pipeline, making use of purrr::map, purrr::map2
* list columns and unnest as necessary to create a tidy dataframe with estimated proportions and CIs for each city.

## Plot estimate and confidence interval for each city's proportion of unsolved homicides
Create a plot that shows the estimates and CIs for each city
* check out  geom_errorbar for a way to add error bars based on the upper and lower limits
* Organize cities according to the proportion of unsolved homicides.

